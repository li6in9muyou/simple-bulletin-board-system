<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>XML作业汇总</title>
    <style>
      input[type="select"] {
        font-size: 10rem;
      }
      #personal-info > div {
        display: flex;
        padding: 2px;
        align-items: center;
      }
      label {
        user-select: none;
      }
      #personal-info > div > label {
        min-width: 25%;
      }
      #personal-info > * {
        padding: 0;
        margin: 0 0 0.5rem;
      }
      #personal-info {
        font-family: FangSong, serif;
        background-color: lightyellow;
        max-width: 60%;
        margin: auto;
      }
      #form-caption {
        background-color: lightgray;
        text-align: center;
        margin-bottom: 0;
      }
      #skills {
        display: flex;
        gap: 1rem;
        align-items: center;
      }
      #department {
        padding: 2px;
      }
    </style>
    <style>
      #secondAssignmentTimetable {
        background-color: lightyellow;
        padding: 8px;
        margin: auto;
      }
      .second-CourseTable {
        margin: auto;
        border: black 2px solid;
        border-radius: 1rem;
        padding: 12px;
      }
      .second-CourseTable--TimeAside {
        max-width: 50px;
        padding: 2px;
      }
      .second-CourseTable--Cell {
        padding: 6px;
        height: 2rem;
        box-shadow: 2px 2px 1px gray;
        cursor: pointer;
      }
      .popup {
        display: none;
        position: absolute;
        padding: 5px;
        z-index: 999;
        top: 0;
        left: 0;
        width: 200px;
        background-color: antiquewhite;
      }
    </style>
    <style>
      #secondAssignmentUserInputValidation {
        background-color: lightyellow;
        padding: 8px;
        margin-top: 2rem;
      }
      .second-UserInput {
        padding: 10px;
        display: flex;
      }
      .second-UserInput--Form {
        display: flex;
        flex-direction: column;
        gap: 2rem;
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <section id="firstAssignment">
      <h1>第一次作业，公司员工个人信息</h1>
      <p>拼凑 HTML input元素即可</p>
      <form action="" id="personal-info">
        <p id="form-caption">公司员工个人信息</p>
        <div>
          <label for="employee-number">工 号：</label>
          <input
            id="employee-number"
            type="text"
            value="11-78101"
            pattern="\d\d-\d\d\d\d\d"
          />
        </div>
        <div>
          <label for="name">姓 名：</label>
          <input id="name" type="text" value="万顺风" />
        </div>
        <div>
          <label>性 别：</label>
          <div>
            <input
              type="radio"
              name="gender"
              id="gender-male"
              value="male"
              checked
            />
            <label for="gender-male">男</label>
            <input
              type="radio"
              name="gender"
              id="gender-female"
              value="female"
            />
            <label for="gender-female">女</label>
          </div>
        </div>
        <div>
          <label for="birth-date">出生日期：</label>
          <input id="birth-date" type="date" value="1978-05-06" />
        </div>
        <div>
          <label for="certification">所学专业：</label>
          <select id="certification">
            <option value="" disabled>选择所学专业</option>
            <option value="machining" selected>机械制造</option>
            <option value="software-engineering">软件工程</option>
            <option value="civil-engineering">土木工程</option>
            <option value="fine-art">美术</option>
          </select>
        </div>
        <div>
          <label for="department">所属部门：</label>
          <select name="department" id="department" multiple size="3">
            <option value="safety" selected>安全部</option>
            <option value="prod-floor-1">一车间</option>
            <option value="quality-control">质检部</option>
            <option value="prod-floor-2">二车间</option>
            <option value="prod-floor-3">三车间</option>
            <option value="prod-floor-4">四车间</option>
          </select>
        </div>
        <div>
          <label for="family-description">家庭情况：</label>
          <textarea name="" id="family-description" cols="30" rows="10">
山东青岛即墨人，农村户口，一子一女，年总收入7万元</textarea
          >
        </div>
        <div>
          <label for="skills">特长：</label>
          <section id="skills">
            <div class="skill">
              <input id="basketball" type="checkbox" value="basketball" />
              <label for="basketball">篮球</label>
            </div>
            <div class="skill">
              <input id="wielding" type="checkbox" value="wielding" />
              <label for="wielding">电焊</label>
            </div>
            <div class="skill">
              <input id="marketing" type="checkbox" value="marketing" />
              <label for="marketing">产品推广</label>
            </div>
          </section>
        </div>
        <div>
          <label for="submit-btn">
            <input type="submit" value="提交" id="submit-btn" />
          </label>
          <input type="reset" value="重置" />
        </div>
      </form>
    </section>
    <section id="secondAssignmentTimetable" data-second-assignment-section>
      <div class="popup" data-popup></div>
      <h1>第二次作业，课程表</h1>
      <p>学习table元素和事件监听器的使用</p>
      <table class="second-CourseTable">
        <thead>
          <tr>
            <th scope="col" colspan="2"><h1>课程表</h1></th>
          </tr>
          <tr>
            <th colspan="1" scope="col">时间表</th>
            <th colspan="1" scope="col">星期六</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="second-CourseTable--TimeAside">
              <span>第一节 08:00-08:45</span>
            </td>
            <td class="second-CourseTable--Cell" data-course-id="xml">
              XML语言，敬信楼F11阶梯教室
            </td>
          </tr>
          <tr>
            <td class="second-CourseTable--TimeAside">
              <span>第二节 08:50-09:35</span>
            </td>
            <td class="second-CourseTable--Cell" data-course-id="xml">
              XML语言，敬信楼F11阶梯教室
            </td>
          </tr>
          <tr>
            <td class="second-CourseTable--TimeAside">
              <span>第三节 09:55-11:40</span>
            </td>
            <td class="second-CourseTable--Cell" data-course-id="xml">
              XML语言，敬信楼F11阶梯教室
            </td>
          </tr>
          <tr>
            <td class="second-CourseTable--TimeAside">
              <span>第四节 10:45-11:30</span>
            </td>
            <td class="second-CourseTable--Cell" data-course-id="xml">
              XML语言，敬信楼F11阶梯教室
            </td>
          </tr>
          <tr>
            <td class="second-CourseTable--TimeAside">
              <span>第五节 11:35-12:20</span>
            </td>
            <td class="second-CourseTable--Cell" data-course-id="empty"></td>
          </tr>
          <tr>
            <td class="second-CourseTable--TimeAside">
              <span>第六节 13:30-14:15</span>
            </td>
            <td class="second-CourseTable--Cell" data-course-id="empty"></td>
          </tr>
          <tr>
            <td class="second-CourseTable--TimeAside">
              <span>第七节 14:20-15:05</span>
            </td>
            <td class="second-CourseTable--Cell" data-course-id="empty"></td>
          </tr>
        </tbody>
      </table>
      <script>
        let prevAnchor = null;
        const GetPopUpAnchor = () =>
          document.querySelector("[data-popup-anchor]");
        const POPUP = document.querySelector("[data-popup]");
        const courseInfo = new Map([
          ["xml", "这是XML语言课程的课程信息"],
          ["empty", "本时间段没有课"],
        ]);
        function removePopUp() {
          POPUP.style.display = "none";
        }
        function showPopUpFor(courseId, element) {
          if (prevAnchor !== null) {
            prevAnchor.removeAttribute("data-popup-anchor");
          }
          element.dataset.popupAnchor = "";
          function showPopUp(text) {
            POPUP.innerText = text;
            POPUP.style.display = "block";
            const popUpAnchor = GetPopUpAnchor();
            popUpAnchor.style.position = "relative";
            popUpAnchor.appendChild(POPUP);
          }

          const info = courseInfo.get(courseId);
          if (info !== undefined) {
            showPopUp(info);
          } else {
            showPopUp(`没有课程${courseId}的信息`);
          }
          prevAnchor = element;
        }
        function attachCourseInfoPopup() {
          document.querySelectorAll("[data-course-id]").forEach((e) => {
            e.addEventListener("click", (ev) => {
              ev.stopPropagation();
              showPopUpFor(e.dataset["courseId"], e);
            });
          });
        }
        window.addEventListener("load", attachCourseInfoPopup);
        document
          .querySelector("[data-second-assignment-section]")
          .addEventListener("click", removePopUp);
      </script>
    </section>
    <section id="secondAssignmentUserInputValidation">
      <h1>第二次作业，检查用户输入</h1>
      <p>检查用户输入并储存到本地文件</p>
      <main class="second-UserInput">
        <section class="second-UserInput--Form">
          <label for="second-username">
            输入用户名
            <input
              type="text"
              id="second-username"
              data-second-username-input
            />
          </label>
          <label for="second-token">
            输入口令
            <input type="text" id="second-token" data-second-token-input />
          </label>
          <button disabled data-export-file>保存到本地文件</button>
        </section>
        <aside class="second-UserInput--ErrorContainer">
          <ul class="second-UserInput--Error" data-errors-list></ul>
        </aside>
      </main>
      <script>
        let global_msg = [],
          msg = [];
        let username_good = false;
        let token_good = false;
        const ERROR_LIST = document.querySelector("[data-errors-list]");
        function renderErrorMessages(arr) {
          ERROR_LIST.innerHTML = "";
          for (const m of arr) {
            const one_error = document.createElement("li");
            one_error.classList.add("errors--error");
            one_error.innerText = m;
            ERROR_LIST.appendChild(one_error);
          }
        }

        const username_validators = [
          [(s) => s === "username", "用户名只能为username"],
        ];

        function isDigit(ch) {
          return "0987654321".includes(ch);
        }

        const token_validators = [
          [
            (s) => s.every((ch) => ch.charCodeAt(0) < 127),
            "口令只能是 ASCII 字符",
          ],
          [(s) => s.length > 10, "口令要超过十个字符长度"],
          [
            (s) => s.some((ch) => !isDigit(ch) && ch === ch.toLowerCase()),
            "口令中要有小写字母",
          ],
          [
            (s) => s.some((ch) => !isDigit(ch) && ch === ch.toUpperCase()),
            "口令中要有大写字母",
          ],
          [(s) => s.some(isDigit), "口令中要有数字"],
        ];

        document
          .querySelector("[data-second-username-input]")
          .addEventListener("input", (ev) => {
            msg = [];
            for (const v of username_validators) {
              const [isValid, help] = v;
              if (!isValid(ev.target.value)) {
                msg.push(help);
              }
            }
            username_good = msg.length === 0;
            renderErrorMessages([...global_msg, ...msg]);
            update_button();
          });

        function update_button() {
          document.querySelector("[data-export-file]").disabled = !(
            username_good && token_good
          );
        }

        function prompt_user_input() {
          global_msg = [];
          if (!username_good) {
            global_msg.push("请填好用户名");
          }
          if (!token_good) {
            global_msg.push("请填好口令");
          }
          if (global_msg.length === 0) {
            global_msg.push("你全部输入正确");
          }
          renderErrorMessages([...msg, ...global_msg]);
        }

        window.addEventListener("load", prompt_user_input);

        document
          .querySelector("[data-export-file]")
          .addEventListener("click", () => {
            saveAs([
              "用户名：\n",
              document.querySelector("[data-second-username-input]").value +
                "\n",
              "口令：\n",
              document.querySelector("[data-second-token-input]").value + "\n",
            ]);
          });

        document
          .querySelector("[data-second-token-input]")
          .addEventListener("input", (ev) => {
            msg = [];
            for (const v of token_validators) {
              const [isValid, help] = v;
              if (!isValid([...ev.target.value])) {
                msg.push(help);
              }
            }
            token_good = msg.length === 0;
            renderErrorMessages([...global_msg, ...msg]);
            update_button();
          });
        document
          .querySelector("[data-second-token-input]")
          .addEventListener("input", prompt_user_input);
        document
          .querySelector("[data-second-username-input]")
          .addEventListener("input", prompt_user_input);

        function saveAs(array) {
          const url = window.URL.createObjectURL(new Blob(array));
          const a = document.createElement("a");
          a.style.display = "none";
          a.href = url;
          a.download = `用户名和口令 ${new Date().toLocaleTimeString()}.txt`;
          document.body.appendChild(a);
          a.click();
          window.URL.revokeObjectURL(url);
        }
      </script>
    </section>
  </body>
</html>
