<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>XML作业汇总</title>
    <style>
      input[type="select"] {
        font-size: 10rem;
      }
      #personal-info > div {
        display: flex;
        padding: 2px;
        align-items: center;
      }
      label {
        user-select: none;
      }
      #personal-info > div > label {
        min-width: 25%;
      }
      #personal-info > * {
        padding: 0;
        margin: 0 0 0.5rem;
      }
      #personal-info {
        font-family: FangSong, serif;
        background-color: lightyellow;
        max-width: 60%;
        margin: auto;
      }
      #form-caption {
        background-color: lightgray;
        text-align: center;
        margin-bottom: 0;
      }
      #skills {
        display: flex;
        gap: 1rem;
        align-items: center;
      }
      #department {
        padding: 2px;
      }
    </style>
    <style>
      #secondAssignmentTimetable {
        background-color: lightyellow;
        padding: 8px;
        margin: auto;
      }
      .second-CourseTable {
        margin: auto;
        border: black 2px solid;
        border-radius: 1rem;
        padding: 12px;
      }
      .second-CourseTable--TimeAside {
        max-width: 50px;
        padding: 2px;
      }
      .second-CourseTable--Cell {
        padding: 6px;
        height: 2rem;
        box-shadow: 2px 2px 1px gray;
        cursor: pointer;
      }
      .popup {
        display: none;
        position: absolute;
        padding: 5px;
        z-index: 999;
        top: 0;
        left: 0;
        width: 200px;
        background-color: antiquewhite;
      }
    </style>
    <style>
      #secondAssignmentUserInputValidation {
        background-color: lightyellow;
        padding: 8px;
        margin-top: 2rem;
      }
      .second-UserInput {
        padding: 10px;
        display: flex;
      }
      .second-UserInput--Form {
        display: flex;
        flex-direction: column;
        gap: 2rem;
        padding: 10px;
      }
    </style>
    <style>
      #secondAssignmentUserCheckOutPage {
        background-color: lightyellow;
        padding: 8px;
        margin-top: 2rem;
      }
      .second-CheckOutPage {
        padding: 10px;
        display: flex;
        flex-direction: column;
        width: fit-content;
      }
      .second-CheckOutPageContainer {
        display: flex;
      }
    </style>
    <style>
      .third-ace-editor {
        height: 500px;
      }
    </style>
    <style>
      .fourth-ace-editor {
        height: 500px;
      }
    </style>
    <style>
      #fifth-student-score-display {
        font-size: 40px;
      }
      #fifth-student-name-select {
        font-size: 2rem;
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <section id="firstAssignment">
      <h1>第一次作业，公司员工个人信息</h1>
      <p>拼凑 HTML input元素即可</p>
      <form action="" id="personal-info">
        <p id="form-caption">公司员工个人信息</p>
        <div>
          <label for="employee-number">工 号：</label>
          <input
            id="employee-number"
            type="text"
            value="11-78101"
            pattern="\d\d-\d\d\d\d\d"
          />
        </div>
        <div>
          <label for="name">姓 名：</label>
          <input id="name" type="text" value="万顺风" />
        </div>
        <div>
          <label>性 别：</label>
          <div>
            <input
              type="radio"
              name="gender"
              id="gender-male"
              value="male"
              checked
            />
            <label for="gender-male">男</label>
            <input
              type="radio"
              name="gender"
              id="gender-female"
              value="female"
            />
            <label for="gender-female">女</label>
          </div>
        </div>
        <div>
          <label for="birth-date">出生日期：</label>
          <input id="birth-date" type="date" value="1978-05-06" />
        </div>
        <div>
          <label for="certification">所学专业：</label>
          <select id="certification">
            <option value="" disabled>选择所学专业</option>
            <option value="machining" selected>机械制造</option>
            <option value="software-engineering">软件工程</option>
            <option value="civil-engineering">土木工程</option>
            <option value="fine-art">美术</option>
          </select>
        </div>
        <div>
          <label for="department">所属部门：</label>
          <select name="department" id="department" multiple size="3">
            <option value="safety" selected>安全部</option>
            <option value="prod-floor-1">一车间</option>
            <option value="quality-control">质检部</option>
            <option value="prod-floor-2">二车间</option>
            <option value="prod-floor-3">三车间</option>
            <option value="prod-floor-4">四车间</option>
          </select>
        </div>
        <div>
          <label for="family-description">家庭情况：</label>
          <textarea name="" id="family-description" cols="30" rows="10">
山东青岛即墨人，农村户口，一子一女，年总收入7万元</textarea
          >
        </div>
        <div>
          <label for="skills">特长：</label>
          <section id="skills">
            <div class="skill">
              <input id="basketball" type="checkbox" value="basketball" />
              <label for="basketball">篮球</label>
            </div>
            <div class="skill">
              <input id="wielding" type="checkbox" value="wielding" />
              <label for="wielding">电焊</label>
            </div>
            <div class="skill">
              <input id="marketing" type="checkbox" value="marketing" />
              <label for="marketing">产品推广</label>
            </div>
          </section>
        </div>
        <div>
          <label for="submit-btn">
            <input type="submit" value="提交" id="submit-btn" />
          </label>
          <input type="reset" value="重置" />
        </div>
      </form>
    </section>
    <section id="secondAssignmentTimetable" data-second-assignment-section>
      <div class="popup" data-popup></div>
      <h1>第二次作业，课程表</h1>
      <p>学习table元素和事件监听器的使用</p>
      <table class="second-CourseTable">
        <thead>
          <tr>
            <th scope="col" colspan="2"><h1>课程表</h1></th>
          </tr>
          <tr>
            <th colspan="1" scope="col">时间表</th>
            <th colspan="1" scope="col">星期六</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="second-CourseTable--TimeAside">
              <span>第一节 08:00-08:45</span>
            </td>
            <td class="second-CourseTable--Cell" data-course-id="xml">
              XML语言，敬信楼F11阶梯教室
            </td>
          </tr>
          <tr>
            <td class="second-CourseTable--TimeAside">
              <span>第二节 08:50-09:35</span>
            </td>
            <td class="second-CourseTable--Cell" data-course-id="xml">
              XML语言，敬信楼F11阶梯教室
            </td>
          </tr>
          <tr>
            <td class="second-CourseTable--TimeAside">
              <span>第三节 09:55-11:40</span>
            </td>
            <td class="second-CourseTable--Cell" data-course-id="xml">
              XML语言，敬信楼F11阶梯教室
            </td>
          </tr>
          <tr>
            <td class="second-CourseTable--TimeAside">
              <span>第四节 10:45-11:30</span>
            </td>
            <td class="second-CourseTable--Cell" data-course-id="xml">
              XML语言，敬信楼F11阶梯教室
            </td>
          </tr>
          <tr>
            <td class="second-CourseTable--TimeAside">
              <span>第五节 11:35-12:20</span>
            </td>
            <td class="second-CourseTable--Cell" data-course-id="empty"></td>
          </tr>
          <tr>
            <td class="second-CourseTable--TimeAside">
              <span>第六节 13:30-14:15</span>
            </td>
            <td class="second-CourseTable--Cell" data-course-id="empty"></td>
          </tr>
          <tr>
            <td class="second-CourseTable--TimeAside">
              <span>第七节 14:20-15:05</span>
            </td>
            <td class="second-CourseTable--Cell" data-course-id="empty"></td>
          </tr>
        </tbody>
      </table>
      <script>
        let prevAnchor = null;
        const GetPopUpAnchor = () =>
          document.querySelector("[data-popup-anchor]");
        const POPUP = document.querySelector("[data-popup]");
        const courseInfo = new Map([
          ["xml", "这是XML语言课程的课程信息"],
          ["empty", "本时间段没有课"],
        ]);
        function removePopUp() {
          POPUP.style.display = "none";
        }
        function showPopUpFor(courseId, element) {
          if (prevAnchor !== null) {
            prevAnchor.removeAttribute("data-popup-anchor");
          }
          element.dataset.popupAnchor = "";
          function showPopUp(text) {
            POPUP.innerText = text;
            POPUP.style.display = "block";
            const popUpAnchor = GetPopUpAnchor();
            popUpAnchor.style.position = "relative";
            popUpAnchor.appendChild(POPUP);
          }

          const info = courseInfo.get(courseId);
          if (info !== undefined) {
            showPopUp(info);
          } else {
            showPopUp(`没有课程${courseId}的信息`);
          }
          prevAnchor = element;
        }
        function attachCourseInfoPopup() {
          document.querySelectorAll("[data-course-id]").forEach((e) => {
            e.addEventListener("click", (ev) => {
              ev.stopPropagation();
              showPopUpFor(e.dataset["courseId"], e);
            });
          });
        }
        window.addEventListener("load", attachCourseInfoPopup);
        document
          .querySelector("[data-second-assignment-section]")
          .addEventListener("click", removePopUp);
      </script>
    </section>
    <section id="secondAssignmentUserInputValidation">
      <h1>第二次作业，检查用户输入</h1>
      <p>检查用户输入并储存到本地文件</p>
      <main class="second-UserInput">
        <section class="second-UserInput--Form">
          <label for="second-username">
            输入用户名
            <input
              type="text"
              id="second-username"
              data-second-username-input
            />
          </label>
          <label for="second-token">
            输入口令
            <input type="text" id="second-token" data-second-token-input />
          </label>
          <button disabled data-export-file>保存到本地文件</button>
        </section>
        <aside class="second-UserInput--ErrorContainer">
          <ul class="second-UserInput--Error" data-errors-list></ul>
        </aside>
      </main>
      <script>
        let global_msg = [],
          msg = [];
        let username_good = false;
        let token_good = false;
        const ERROR_LIST = document.querySelector("[data-errors-list]");
        function renderErrorMessages(arr) {
          ERROR_LIST.innerHTML = "";
          for (const m of arr) {
            const one_error = document.createElement("li");
            one_error.classList.add("errors--error");
            one_error.innerText = m;
            ERROR_LIST.appendChild(one_error);
          }
        }

        const username_validators = [
          [(s) => s === "username", "用户名只能为username"],
        ];

        function isDigit(ch) {
          return "0987654321".includes(ch);
        }

        const token_validators = [
          [
            (s) => s.every((ch) => ch.charCodeAt(0) < 127),
            "口令只能是 ASCII 字符",
          ],
          [(s) => s.length > 10, "口令要超过十个字符长度"],
          [
            (s) => s.some((ch) => !isDigit(ch) && ch === ch.toLowerCase()),
            "口令中要有小写字母",
          ],
          [
            (s) => s.some((ch) => !isDigit(ch) && ch === ch.toUpperCase()),
            "口令中要有大写字母",
          ],
          [(s) => s.some(isDigit), "口令中要有数字"],
        ];

        document
          .querySelector("[data-second-username-input]")
          .addEventListener("input", (ev) => {
            msg = [];
            for (const v of username_validators) {
              const [isValid, help] = v;
              if (!isValid(ev.target.value)) {
                msg.push(help);
              }
            }
            username_good = msg.length === 0;
            renderErrorMessages([...global_msg, ...msg]);
            update_button();
          });

        function update_button() {
          document.querySelector("[data-export-file]").disabled = !(
            username_good && token_good
          );
        }

        function prompt_user_input() {
          global_msg = [];
          if (!username_good) {
            global_msg.push("请填好用户名");
          }
          if (!token_good) {
            global_msg.push("请填好口令");
          }
          if (global_msg.length === 0) {
            global_msg.push("你全部输入正确");
          }
          renderErrorMessages([...msg, ...global_msg]);
        }

        window.addEventListener("load", prompt_user_input);

        document
          .querySelector("[data-export-file]")
          .addEventListener("click", () => {
            saveAs([
              "用户名：\n",
              document.querySelector("[data-second-username-input]").value +
                "\n",
              "口令：\n",
              document.querySelector("[data-second-token-input]").value + "\n",
            ]);
          });

        document
          .querySelector("[data-second-token-input]")
          .addEventListener("input", (ev) => {
            msg = [];
            for (const v of token_validators) {
              const [isValid, help] = v;
              if (!isValid([...ev.target.value])) {
                msg.push(help);
              }
            }
            token_good = msg.length === 0;
            renderErrorMessages([...global_msg, ...msg]);
            update_button();
          });
        document
          .querySelector("[data-second-token-input]")
          .addEventListener("input", prompt_user_input);
        document
          .querySelector("[data-second-username-input]")
          .addEventListener("input", prompt_user_input);

        function saveAs(array) {
          const url = window.URL.createObjectURL(new Blob(array));
          const a = document.createElement("a");
          a.style.display = "none";
          a.href = url;
          a.download = `用户名和口令 ${new Date().toLocaleTimeString()}.txt`;
          document.body.appendChild(a);
          a.click();
          window.URL.revokeObjectURL(url);
        }
      </script>
    </section>
    <section id="secondAssignmentUserCheckOutPage">
      <h1>第二次作业，检查用户输入，第二个</h1>
      <p>检查用户输入并储存到本地文件</p>
      <main class="second-CheckOutPageContainer">
        <section class="second-CheckOutPage">
          <label for="itemName">商品名称</label>
          <select id="itemName" class="second-CheckOutPage--Item">
            <option value="" disabled>选择商品</option>
            <option value="mechanical-keyboard" selected>机械硬盘</option>
            <option value="hard-disk-drive">机械键盘</option>
            <option value="solid-state-drive">固态硬盘</option>
            <option value="cheap-keyboard">硅胶碗键盘</option>
          </select>
          <div class="second-CheckOutPage--Price">
            商品价格
            <span data-item-price></span>
          </div>
          <label for="second-buy-count">
            购买数量
            <input
              type="number"
              id="second-buy-count"
              data-second-buy-count
              value="1"
              min="1"
            />
          </label>
          <label for="second-charge">
            金额
            <input
              type="number"
              id="second-charge"
              data-second-charge
              value="1"
              min="1"
            />
          </label>
          <button disabled data-submit-purchase>提交</button>
        </section>
        <aside class="second-UserInput--ErrorContainer">
          <ul class="second-UserInput--Error" data-errors-list-checkout></ul>
        </aside>
      </main>
      <script>
        document.querySelector("[data-item-price]").innerText = "999";
      </script>
      <script>
        (function () {
          let global_msg = [],
            msg = [];
          const ERROR_LIST = document.querySelector(
            "[data-errors-list-checkout]"
          );
          function renderErrorMessages(arr) {
            ERROR_LIST.innerHTML = "";
            for (const m of arr) {
              const one_error = document.createElement("li");
              one_error.classList.add("errors--error");
              one_error.innerText = m;
              ERROR_LIST.appendChild(one_error);
            }
          }
          const validators = [
            [
              () => {
                const number = Number(
                  document.querySelector("[data-item-price]").innerHTML
                );
                const item_count = Number(
                  document.querySelector("[data-second-buy-count]").value
                );
                const entered_pay = Number(
                  document.querySelector("[data-second-charge]").value
                );
                return entered_pay === number * item_count;
              },
              "金额计算错误",
            ],
          ];
          document
            .querySelector("[data-second-charge]")
            .addEventListener("input", (ev) => {
              msg = [];
              for (const v of validators) {
                const [isValid, help] = v;
                if (!isValid(ev.target.value)) {
                  msg.push(help);
                }
              }
              username_good = msg.length === 0;
              renderErrorMessages([...global_msg, ...msg]);
              update_button();
            });
        })();
      </script>
    </section>
    <section id="hand-written-xml">
      <h1>第三次作业，手写两个xml文件</h1>
      <h2>第一个，学生成绩统计表</h2>
      <p>实验原理：依葫芦画瓢，照猫画虎。</p>
      <div id="third-ace-editor-one" class="third-ace-editor"></div>
      <h2>第二个，班级通讯录</h2>
      <p>实验原理：大胆设计，小心实现。</p>
      <div id="third-ace-editor-two" class="third-ace-editor"></div>
      <script
        src="https://cdn.jsdelivr.net/npm/ace-builds@1.13.0/src-noconflict/ace.min.js"
        type="text/javascript"
        charset="utf-8"
      ></script>
      <script>
        const one = `<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE studentScores [

<!ELEMENT studentScores (student+)>
<!ELEMENT student (name,avg,courses)>
<!ELEMENT name (#PCDATA)>
<!ELEMENT avg (#PCDATA)>
<!ELEMENT courses (course*)>
<!ELEMENT course (name, score)>
<!ELEMENT score (#PCDATA)>
]>
<studentScores>
  <student>
    <name>张三</name>
    <avg>85.67</avg>
    <courses>
      <course>
        <name>编译方法</name>
        <score>79</score>
      </course>
      <course>
        <name>C程序设计</name>
        <score>85</score>
      </course>
      <course>
        <name>数据结构</name>
        <score>93</score>
      </course>
    </courses>
  </student>
  <student>
    <name>李四</name>
    <avg>84.33</avg>
    <courses>
      <course>
        <name>计算复杂性</name>
        <score>72</score>
      </course>
      <course>
        <name>偏微分方程</name>
        <score>86</score>
      </course>
      <course>
        <name>计算方法</name>
        <score>95</score>
      </course>
    </courses>
  </student>
  <student>
    <name>王五</name>
    <avg>86.25</avg>
    <courses>
      <course>
        <name>分子轨道理论</name>
        <score>79</score>
      </course>
      <course>
        <name>有机化学</name>
        <score>80</score>
      </course>
      <course>
        <name>分子生物学</name>
        <score>88</score>
      </course>
      <course>
        <name>无机化学</name>
        <score>98</score>
      </course>
    </courses>
  </student>
</studentScores>`;
        ace.config.set(
          "basePath",
          "https://cdn.jsdelivr.net/npm/ace-builds@1.13.0/src-noconflict"
        );
        const editor = ace.edit("third-ace-editor-one");
        editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/xml");
        editor.session.setValue(one);
        editor.setReadOnly(true);

        const twoText = `
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE contacts [
<!ELEMENT contacts (contact+)>
<!ELEMENT contact (handle, link)>
<!ELEMENT handle (#PCDATA)>
<!ELEMENT link (#PCDATA)>
]>
<contacts>
<contact>
    <handle>li6in9muyou</handle>
    <link>blog.li6q.fun</link>
</contact>
<contact>
    <handle>Physically Based Rendering</handle>
    <link>www.pbrt.org</link>
</contact>
<contact>
    <handle>Go</handle>
    <link>go.dev</link>
</contact>
<contact>
    <handle>OpenGL</handle>
    <link>www.opengl.org</link>
</contact>
<contact>
    <handle>JetBrains</handle>
    <link>jetbrains.com</link>
</contact>
</contacts>
`;
        const two = ace.edit("third-ace-editor-two");
        two.setTheme("ace/theme/monokai");
        two.session.setMode("ace/mode/xml");
        two.session.setValue(twoText);
        two.setReadOnly(true);
      </script>
    </section>
    <section id="hand-written-xslt">
      <h1>第四次作业，手写三个XSL模版</h1>
      <h2>第一个，CD唱片目录</h2>
      <p>实验原理：用 xsl:when 标签有条件地选择输出的片段</p>
      <h3>XML数据</h3>
      <div id="fourth-one-xml" class="fourth-ace-editor"></div>
      <h3>XSL模版</h3>
      <div id="fourth-one-xsl" class="fourth-ace-editor"></div>
      <h2>第二个，学生成绩表输出为HTML</h2>
      <p>
        实验原理：用 rowspan 属性设置行宽度，用 xsl:variable
        动态计算课程的数量以适应不同学生有不同数量的课程
      </p>
      <h3>XML数据</h3>
      <div id="fourth-two-xml" class="fourth-ace-editor"></div>
      <h3>XSL模版</h3>
      <div id="fourth-two-xsl" class="fourth-ace-editor"></div>
      <h2>第三个，会员信息XML定义和输出为HTML</h2>
      <p>
        实验原理：用 rowspan 属性设置行宽度，用 xsl:variable
        动态计算课程的数量以适应不同会员有不同数量的电话号码
      </p>
      <h3>XML数据</h3>
      <div id="fourth-three-xml" class="fourth-ace-editor"></div>
      <h3>XSL模版</h3>
      <div id="fourth-three-xsl" class="fourth-ace-editor"></div>
      <script>
        const oneXML = `<?xml version="1.0" encoding="UTF-8"?>
<catalog>
  <cd>
    <title>Empire Burlesque</title>
    <artist>Bob Dylan</artist>
    <country>USA</country>
    <company>Columbia</company>
    <price>10.90</price>
    <year>1985</year>
  </cd>
  <cd>
    <title>Hide your heart</title>
    <artist>Bonnie Tyler</artist>
    <country>UK</country>
    <company>CBS Records</company>
    <price>9.90</price>
    <year>1988</year>
  </cd>
  <cd>
    <title>Greatest Hits</title>
    <artist>Dolly Parton</artist>
    <country>USA</country>
    <company>RCA</company>
    <price>9.90</price>
    <year>1982</year>
  </cd>
  <cd>
    <title>Still got the blues</title>
    <artist>Gary Moore</artist>
    <country>UK</country>
    <company>Virgin records</company>
    <price>10.20</price>
    <year>1990</year>
  </cd>
  <cd>
    <title>Eros</title>
    <artist>Eros Ramazzotti</artist>
    <country>EU</country>
    <company>BMG</company>
    <price>9.90</price>
    <year>1997</year>
  </cd>
  <cd>
    <title>One night only</title>
    <artist>Bee Gees</artist>
    <country>UK</country>
    <company>Polydor</company>
    <price>10.90</price>
    <year>1998</year>
  </cd>
  <cd>
    <title>Sylvias Mother</title>
    <artist>Dr.Hook</artist>
    <country>UK</country>
    <company>CBS</company>
    <price>8.10</price>
    <year>1973</year>
  </cd>
  <cd>
    <title>Maggie May</title>
    <artist>Rod Stewart</artist>
    <country>UK</country>
    <company>Pickwick</company>
    <price>8.50</price>
    <year>1990</year>
  </cd>
  <cd>
    <title>Romanza</title>
    <artist>Andrea Bocelli</artist>
    <country>EU</country>
    <company>Polydor</company>
    <price>10.80</price>
    <year>1996</year>
  </cd>
  <cd>
    <title>When a man loves a woman</title>
    <artist>Percy Sledge</artist>
    <country>USA</country>
    <company>Atlantic</company>
    <price>8.70</price>
    <year>1987</year>
  </cd>
  <cd>
    <title>Black angel</title>
    <artist>Savage Rose</artist>
    <country>EU</country>
    <company>Mega</company>
    <price>10.90</price>
    <year>1995</year>
  </cd>
  <cd>
    <title>1999 Grammy Nominees</title>
    <artist>Many</artist>
    <country>USA</country>
    <company>Grammy</company>
    <price>10.20</price>
    <year>1999</year>
  </cd>
  <cd>
    <title>For the good times</title>
    <artist>Kenny Rogers</artist>
    <country>UK</country>
    <company>Mucik Master</company>
    <price>8.70</price>
    <year>1995</year>
  </cd>
  <cd>
    <title>Big Willie style</title>
    <artist>Will Smith</artist>
    <country>USA</country>
    <company>Columbia</company>
    <price>9.90</price>
    <year>1997</year>
  </cd>
  <cd>
    <title>Tupelo Honey</title>
    <artist>Van Morrison</artist>
    <country>UK</country>
    <company>Polydor</company>
    <price>8.20</price>
    <year>1971</year>
  </cd>
  <cd>
    <title>Soulsville</title>
    <artist>Jorn Hoel</artist>
    <country>Norway</country>
    <company>WEA</company>
    <price>7.90</price>
    <year>1996</year>
  </cd>
  <cd>
    <title>The very best of</title>
    <artist>Cat Stevens</artist>
    <country>UK</country>
    <company>Island</company>
    <price>8.90</price>
    <year>1990</year>
  </cd>
  <cd>
    <title>Stop</title>
    <artist>Sam Brown</artist>
    <country>UK</country>
    <company>A and M</company>
    <price>8.90</price>
    <year>1988</year>
  </cd>
  <cd>
    <title>Bridge of Spies</title>
    <artist>T\`Pau</artist>
    <country>UK</country>
    <company>Siren</company>
    <price>7.90</price>
    <year>1987</year>
  </cd>
  <cd>
    <title>Private Dancer</title>
    <artist>Tina Turner</artist>
    <country>UK</country>
    <company>Capitol</company>
    <price>8.90</price>
    <year>1983</year>
  </cd>
  <cd>
    <title>Midt om natten</title>
    <artist>Kim Larsen</artist>
    <country>EU</country>
    <company>Medley</company>
    <price>7.80</price>
    <year>1983</year>
  </cd>
  <cd>
    <title>Pavarotti Gala Concert</title>
    <artist>Luciano Pavarotti</artist>
    <country>UK</country>
    <company>DECCA</company>
    <price>9.90</price>
    <year>1991</year>
  </cd>
  <cd>
    <title>The dock of the bay</title>
    <artist>Otis Redding</artist>
    <country>USA</country>
    <company>Stax Records</company>
    <price>7.90</price>
    <year>1968</year>
  </cd>
  <cd>
    <title>Picture book</title>
    <artist>Simply Red</artist>
    <country>EU</country>
    <company>Elektra</company>
    <price>7.20</price>
    <year>1985</year>
  </cd>
  <cd>
    <title>Red</title>
    <artist>The Communards</artist>
    <country>UK</country>
    <company>London</company>
    <price>7.80</price>
    <year>1987</year>
  </cd>
  <cd>
    <title>Unchain my heart</title>
    <artist>Joe Cocker</artist>
    <country>USA</country>
    <company>EMI</company>
    <price>8.20</price>
    <year>1987</year>
  </cd>
</catalog>`;
        const oneXSL = `<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
<html>
<body>
  <h2>My CD Collection</h2>
  <table border="1">
    <tr bgcolor="#9acd32">
      <th style="text-align:left">Title</th>
      <th style="text-align:left">Artist</th>
      <th style="text-align:left">Price</th>
      <th style="text-align:left">Year</th>
    </tr>
    <xsl:for-each select="catalog/cd[year>1980]">
      <xsl:sort select="year" data-type="number" order="descending"/>
    <tr>
      <td><xsl:value-of select="title"/></td>
      <td><xsl:value-of select="artist"/></td>
<xsl:choose>
<xsl:when test="price &lt; 8">
        <td bgcolor="#00ffff">
          <xsl:value-of select="price"/>
        </td>
</xsl:when >
<xsl:when test="price &gt; 10">
        <td bgcolor="#ff0000">
          <xsl:value-of select="price"/>
        </td>
</xsl:when>
<xsl:when test="price &gt; 9">
        <td bgcolor="#ff8000">
          <xsl:value-of select="price"/>
        </td>
</xsl:when>
<xsl:when test="price &gt; 8">
        <td bgcolor="#ffc0cb">
          <xsl:value-of select="price"/>
        </td>
</xsl:when >
</xsl:choose>
<td><xsl:value-of select="year"/></td>
    </tr>
    </xsl:for-each>
  </table>
</body>
</html>
</xsl:template>
</xsl:stylesheet>`;
        const twoXML = `<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE studentScores [
<!ELEMENT studentScores (student+)>
<!ELEMENT student (name,avg,courses)>
<!ELEMENT name (#PCDATA)>
<!ELEMENT avg (#PCDATA)>
<!ELEMENT courses (course*)>
<!ELEMENT course (name, score, modifiedDate)>
<!ELEMENT score (#PCDATA)>
<!ELEMENT modifiedDate (#PCDATA)>
]>
<studentScores>
  <student>
    <name>张三</name>
    <avg>85.67</avg>
    <courses>
      <course>
        <name>编译方法</name>
        <score>79</score>
<modifiedDate>2021/12/06</modifiedDate>
      </course>
      <course>
        <name>C程序设计</name>
        <score>85</score>
<modifiedDate>2021/12/06</modifiedDate>
      </course>
      <course>
        <name>数据结构</name>
        <score>93</score>
<modifiedDate>2021/12/06</modifiedDate>
      </course>
    </courses>
  </student>
  <student>
    <name>李四</name>
    <avg>84.33</avg>
    <courses>
      <course>
        <name>计算复杂性</name>
        <score>72</score>
<modifiedDate>2021/12/06</modifiedDate>
      </course>
      <course>
        <name>偏微分方程</name>
        <score>86</score>
<modifiedDate>2021/12/06</modifiedDate>
      </course>
      <course>
        <name>计算方法</name>
        <score>95</score>
<modifiedDate>2021/12/06</modifiedDate>
      </course>
    </courses>
  </student>
  <student>
    <name>王五</name>
    <avg>86.25</avg>
    <courses>
      <course>
        <name>分子轨道理论</name>
        <score>79</score>
<modifiedDate>2021/12/06</modifiedDate>
      </course>
      <course>
        <name>有机化学</name>
        <score>80</score>
<modifiedDate>2021/12/06</modifiedDate>
      </course>
      <course>
        <name>分子生物学</name>
        <score>88</score>
<modifiedDate>2021/12/06</modifiedDate>
      </course>
      <course>
        <name>无机化学</name>
        <score>98</score>
<modifiedDate>2021/12/06</modifiedDate>
      </course>
    </courses>
  </student>
</studentScores>`;
        const twoXSL = `<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="student">
  <xsl:variable name="rspan" select="count(courses/course)"></xsl:variable>
  <tr>
    <th rowspan="{$rspan+1}"><xsl:value-of select="name"/></th>
    <th rowspan="{$rspan+1}"><xsl:value-of select="avg"/></th>
  </tr>
  <xsl:for-each select="courses/course">
    <tr>
      <td><xsl:value-of select="name"/></td>
      <td><xsl:value-of select="score"/></td>
      <td><xsl:value-of select="modifiedDate"/></td>
    </tr>
  </xsl:for-each>
</xsl:template>
<xsl:template match="/">
<html>
<body>
  <h2>学生成绩表</h2>
  <table border="1">
    <tr bgcolor="#9acd32">
      <th style="text-align:left">姓名</th>
      <th style="text-align:left">平均成绩</th>
      <th style="text-align:left">课程名称</th>
      <th style="text-align:left">单科成绩</th>
      <th style="text-align:left">录入时间</th>
    </tr>
    <xsl:apply-templates/>
  </table>
</body>
</html>
</xsl:template>
</xsl:stylesheet>`;
        const threeXML = `<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE members [
<!ELEMENT members (member+)>
<!ELEMENT member (name,id,gender,addr,telephones)>
<!ELEMENT telephones (telephoneNumber, telephoneType)>
<!ELEMENT telephoneNumber (#PCDATA)>
<!ELEMENT telephoneType (#PCDATA)>
<!ELEMENT name (#PCDATA)>
<!ELEMENT id (#PCDATA)>
<!ELEMENT gender (#PCDATA)>
<!ELEMENT addr (#PCDATA)>
]>

<members>
<member>

<name>李倩倩</name>
<id>10191101</id>
<gender>女</gender>
<addr>前卫胡同126号</addr>
<telephones>
<telephone>
<telephoneNumber>88662255</telephoneNumber>
<telephoneType>住宅</telephoneType>
</telephone>
<telephone>
<telephoneNumber>13012345678</telephoneNumber>
<telephoneType>移动电话</telephoneType>
</telephone>
</telephones>
</member>

<member>
<name>王晓明</name>
<id>10191203</id>
<gender>男</gender>
<addr>北京大街103号</addr>
<telephones>
<telephone>
<telephoneNumber>85943212</telephoneNumber>
<telephoneType>办公</telephoneType>
</telephone>
</telephones>
</member>
</members>`;
        const threeXSL = `<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
<html>
<body>
  <table border="1">
    <tr bgcolor="#9acd32">
      <th style="text-align:left">姓名</th>
      <th style="text-align:left">会员编号</th>
      <th style="text-align:left">性别</th>
      <th style="text-align:left">地址</th>
      <th style="text-align:left">电话号码</th>
      <th style="text-align:left">电话类型</th>
    </tr>
<xsl:for-each select="members/member">
<xsl:variable name="rspan" select="count(telephones/telephone)"></xsl:variable>
<tr>
  <th rowspan="{$rspan+1}"><xsl:value-of select="name"/></th>
  <th rowspan="{$rspan+1}"><xsl:value-of select="id"/></th>
  <th rowspan="{$rspan+1}"><xsl:value-of select="gender"/></th>
  <th rowspan="{$rspan+1}"><xsl:value-of select="addr"/></th>
</tr>
    <xsl:for-each select="telephones/telephone">
<tr>
      <td><xsl:value-of select="telephoneNumber"/></td>
      <td><xsl:value-of select="telephoneType"/></td>
</tr>
    </xsl:for-each>

</xsl:for-each>
  </table>
</body>
</html>
</xsl:template>
</xsl:stylesheet>`;
      </script>
      <script src="https://cdn.jsdelivr.net/npm/xml-beautify@1.2.3/dist/XmlBeautify.js"></script>
      <script>
        ace.config.set(
          "basePath",
          "https://cdn.jsdelivr.net/npm/ace-builds@1.13.0/src-noconflict"
        );
        const B = new XmlBeautify();
        (() => {
          function genEditor(text, id) {
            const e = ace.edit(id);
            e.setTheme("ace/theme/monokai");
            e.session.setMode("ace/mode/xml");
            e.session.setValue(B.beautify(text));
            e.setReadOnly(true);
          }

          genEditor(oneXML, "fourth-one-xml");
          genEditor(oneXSL, "fourth-one-xsl");
          genEditor(twoXML, "fourth-two-xml");
          genEditor(twoXSL, "fourth-two-xsl");
          genEditor(threeXML, "fourth-three-xml");
          genEditor(threeXSL, "fourth-three-xsl");
        })();
      </script>
    </section>
    <section id="interactiveXML">
      <h1>第五次作业，交互式XSL渲染</h1>
      <p>
        先要在XSL文档中做一个专门用来渲染student节点的模版。具体看
        <a href="https://github.com/li6in9muyou/xml-course/commit/16efeed7">
          这个提交 </a
        >。 在JavaScript环境下用document.evaluate()来执行XPath检索。
        用XSLTProcessor来执行转换，用DOMParser来解析XML和XSLT文档。
        按照学生的姓名检索XML文档树，检索到了后用XSL来转换，最后插入到HTML文档树中。
      </p>
      <main>
        <label>
          姓名
          <select data-select-student id="fifth-student-name-select"></select>
        </label>
        <div id="fifth-student-score-display" data-fifth-display></div>
      </main>
      <script>
        const fifth_display = document.querySelector("[data-fifth-display]");
        const xmlText = twoXML;
        const xslText = twoXSL;
        const select_student_control = document.querySelector(
          "[data-select-student]"
        );

        const p = new DOMParser();
        const xml = p.parseFromString(xmlText, "application/xml");
        const xsl = p.parseFromString(xslText, "application/xml");
        const trans = new XSLTProcessor();
        trans.importStylesheet(xsl);
        const it = xml.evaluate(
          "studentScores/student/name/text()",
          xml,
          null,
          XPathResult.ORDERED_NODE_ITERATOR_TYPE,
          null
        );
        const first = it.iterateNext();
        renderOneStudent(first.data);
        for (let name = first; name != null; name = it.iterateNext()) {
          const op = document.createElement("option");
          op.value = name.data;
          op.innerText = name.data;
          select_student_control.appendChild(op);
        }
        function getStudentByName(name) {
          return xml.evaluate(
            `studentScores/student[name = '${name}']`,
            xml,
            null,
            XPathResult.FIRST_ORDERED_NODE_TYPE,
            null
          )?.singleNodeValue;
        }
        function renderOneStudent(name) {
          fifth_display.replaceChildren(
            trans.transformToFragment(getStudentByName(name), document)
          );
        }
        select_student_control.addEventListener("change", (e) => {
          const name = e.target.value;
          renderOneStudent(name);
        });
      </script>
    </section>
  </body>
</html>
